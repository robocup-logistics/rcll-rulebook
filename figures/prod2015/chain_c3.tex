\documentclass[12pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{graphicx,xcolor}
\usepackage[active,tightpage]{preview}
\input{tikz_products}
\PreviewEnvironment{tikzpicture}
\begin{document}
\begin{tikzpicture}[node distance=4em,level distance=1.6cm,sibling distance=5mm,draw=orange!80]
  \node[M] (bs) {BS}  [thick]
  child[grow=right] { node[P] (be) {}
    child[grow=right,->] { node[M] (rs1-1) {RS 1}
      child[grow=right] { node[P] (be-yellow) {}
        child[grow=right,->] { node[M] (rs2-1) {RS 2}
          child[grow=up,left,level distance=1.2cm,<-]  { node [P,left=.4] (rs2-1-ae1) {} }
          child[grow=up,right,level distance=1.2cm,<-] { node [P,right=.4] (rs2-1-ae2) {} }
          child[grow=right] { node[P] (be-yellow-orange) {}
            child[grow=right,->] { node[M] (rs2-2) {RS 2}
              child[grow=up,level distance=1.2cm,<-]  { node [P] (rs2-2-ae1) {} }
              child[grow=right] { node[P] (be-yellow-orange-green) {}
                child[grow=right,->] { node[M] (cs2) {CS 2}
                  child[grow=up,level distance=1.2cm,<-]  { node [P] (cs-input) {} }
                  child[grow=right] { node[P] (be-yellow-orange-green-cap) {} }
                }
              }
            }
          }
        }
      }
    }
  };
  \draw (be) pic [scale=.3] {base=red};
  \draw [every pic/.style={scale=0.3}] (be-yellow) pic {base=red} ++(0,.175) pic {ring=yellow};
  \draw [every pic/.style={scale=0.3}] (be-yellow-orange)
  pic {base=red} ++(0,.17) pic {ring=yellow} ++(0,.17) pic {ring=orange};
  \draw [every pic/.style={scale=0.3}] (be-yellow-orange-green)
  pic {base=red} ++(0,.17) pic {ring=yellow} ++(0,.17) pic {ring=orange} ++(0,.17) pic {ring=green};
  \draw [every pic/.style={scale=0.3}] (be-yellow-orange-green-cap)
  pic {base=red} ++(0,.17) pic {ring=yellow} ++(0,.17) pic {ring=orange} ++(0,.17) pic {ring=green}
  ++(0,.06) pic {cap=gray};
  \draw (rs2-1-ae1) pic [scale=.3] {any-base};
  \draw (rs2-1-ae2) pic [scale=.3] {any-base};
  \draw (rs2-2-ae1) pic [scale=.3] {any-base};
  \draw [every pic/.style={scale=0.3}] (cs-input) pic {any-base} ++(0,.06) pic {cap=gray};
\end{tikzpicture}
\end{document}
%%% Local Variables: 
%%% mode: latex
%%% TeX-master: t
%%% End: 
